= TMForum API Developer's Handbook Part 3, The API Development Loop
TM Forum Specification
Revision
:Revision: 1.0.0
:Date: 18-Mar-2024
:IPR-Mode: RAND
:TMF-Number: TODO
:Status: DRAFT
:Release-Status: Pre-production
:url-repo: https://github.com/tmforum-rand/ig1353-api-developers-guide
:doctype: book
:toc: 

== Executive Summary

This “How To” document set provides onboarding instructions and a user-guide for the TMForum Open-API development tools. The document is organized in multiple parts as follows:

[options=header]
|===
|Document Part |Summary

|*Part One: Initial Onboarding* |Prerequisites/Good To Know, First-Time Onboarding
|*Part Two: Starting a New API* |API Inception, API Profile, Getting an API Number
|*Part Three: The API Development Loop* |Admin: JIRA issues, Git issues and Branching, API Tools, How To Deep-Dives
|*Part Four: Advanced API Development* |ASyncAPI Specifications, How to make a DCS API, How to make a Composite API
|===


This part (Part Three) of the document provides an overview of the API development process, the inputs expected by the API author and the use of the tools to generate the necessary documents.

:sectnums:
== Managing Our Work

The TMForum uses a number of online collaboration tools to manage member's work across multiple companies and timezones. This includes weekly meetings, evolution of the API design patterns, API development progress and technical backlogs.

=== Tracking API Asset Production

* Use of JIRA, dashboards, EPICs

=== Technical JIRAs: The API Backlog

* Use of the "Component" attribute
* Reviewed weekly: Only to get consensus on a direction
* Making a report with JQL
* Attaching the technical backlog to the API EPIC?

=== Git Issues: The Tooling and CI/CD Backlog

* Tooling is more code-centric, so more amenable to direct Git references and Git issues
* Reviewed weekly

== The Production Process

Maybe this is just a sumamry table or a flow diagram:

* OAS Specification Generation
* PlantUML Diagram Generation
* Confirmance Profile Generation
* CTK Generation
* RI/Sample Code Generation
* The Publication Process

== How To

=== Creating a CodeSpace

Codespace (https://docs.github.com/en/codespaces/overview) is a development environment that is spun-up on request and hosted on your behalf in the Azure cloud by GitHub. This mitigates the technical problems caused by members having different in-house development environments, configurations, language/tool versions, and restrictive corporate firewalls. 

The TMForum pay for this hosting, and boundaries are set on how much RAM and CPU resource is allocated and how long the instance will remain when unattended. The codespace is created from an Ubuntu Linux image that includes popular languages and tools by default.

image::images/part3-codespace.png[Codespaces,1440,1030,align="center",link=https://docs.github.com/en/codespaces/overview,window=_blank]

WARNING: If you create a codespace and work on files locally within it - *and then leave it unattended for more than a few days*, Azure will delete the instance and any local work within it will be lost. Your GitHub registered email address will recieve warning emails from <noreply@github.com> as this deadline approaches.
Always remember to check your work back into your branch before you leave, to avoid any loss.

*To create a Codespace*:

. Having logged into GitHub.com with your TMForum registered identity, navigate to the v5 API repository: https://github.com/tmforum-rand/OAS_Open_API_And_Data_Model

image::images/part3-repo.png[Repository,762,116,align="center",link=https://github.com/tmforum-rand/OAS_Open_API_And_Data_Model,window=_blank]

[start=2]
. The left hand drop-down in the screenshot above indicates your current branch (shown as _v5.0.0-dev_). Click this and select the appropriate branch for your API work.
. Now click the green "*<> Code*" button to the right. This will list any active codespaces that you may have, and allow you to create a new codespace on this current branch, by selecting the "+" button:

image::images/part3-codespace-create.png[Codespace,685,370,align="center",link=https://github.com/tmforum-rand/OAS_Open_API_And_Data_Model,window=_blank]

WARNING: Do make sure you are in the *right repository*, and the *right branch* before doing this - to ensure that GitHub spins up the right configuration for you.

[start=4]
. The codespace will request permissions related to spinning-up the Azure instance. Hit "*Authorize and continue*":

image::images/part3-codespace-authorize.png[Codespace,550,367,align="center",link=https://github.com/codespaces/allow_permissions,window=_blank]

[start=5]
. The codespace will now start up, which may take a minute to produce the initial Microsoft Code IDE within your browser. It will take a further few minutes to run up a docker instance from the terminal window at the bottom. This will finish when the following popup appears in the bottom-right of the browser:

image::images/part3-codespace-app-running.png[Codespace,456,115,align="center",link=https://github.com/codespaces/allow_permissions,window=_blank]

This application presents a simplified menu-driven front-end to the API tooling. Hit "*Open in Browser*" to see this appear in another tab - but you can ignore it for now, we will get back to it later.

If you have ever closed this tab and need to recreate it, click on the *PORTS* tab at the bottom of the main IDE window. Here you should see a single *Port*: 3000 line with column titles of *Forwarded Address*, *Running Process*, *Visibility* and *Origin*. Hover your mouse over the URL under *Forwarded Address* and you should see a small globe icon (highlighted in the circle below):

image::images/part3-codespace-port.png[Codespace,900,108,align="center",link=https://github.com/codespaces/allow_permissions,window=_blank]

If you click on this globe icon, the Web UI tab should be recreated.

*Back in the main IDE tab*: If you use Microsoft's Visual Studio Code IDE (https://code.visualstudio.com/), this will be a familiar layout, but presented through a web browser to an instance running in the Azure cloud, and looking at the TMForum v5 API repository. You can browse and modify files, and changes will be tracked for you to stage and commit from within the IDE back into this Git repository.

This link (https://docs.github.com/en/codespaces/getting-started/quickstart) describes the basics of using Codespaces, including source control and extensions.

=== Rules File Deep Dive

The TMF API rules file, along with JSON schema files - form the main areas of influence in the construction of a TMF API. It is a YAML file, written in a Domain-Specific Language invented within the TMForum. Its purpose is to describe the structure of the generated OAS file, and it is the main input to the TMF OAS generator.

It describes:

* The API meta data: Its *name*, *TMF-number*, *description*, *version* and *hostUrl*
* A list of *resources*, each having:
** A list of *operations* (POST, PATCH, GET or DELETE) available on that resource
*** For each operation a possible list of *examples*
*** For each operation a possible list of *excluded parameters* (for example, you would not expect to be able to POST a status attribute, so you might exclude this from the POST operation)
** A list of *notifications*. These are the events that the resource might emit (such as a state change event), that a subscriber might express an interest in.

The beginning  of the API rules file - describing the API metadata looks like this:
[source, yaml]
----
rulesVersion: 1.0.0                                         <1>
api:
  name:        MyAPI                                        <2>
  shortName:   MyAPI                                        <3>
  description: MyAPI description                            <4>
  tmfId:       TMFxxx                                       <5>
  hostUrl:     'https://serverRoot/tmf-api/MyAPI/v5/'       <6>
  version:     5.0.0                                        <7>
----
<1> This is the *version of the rules file format itself* - not of the API under construction. It is used by the OAS generator to warn of any outdated syntax, and will change very infrequently
<2> This is the name of your API. It will appear in the OAS file in the *info.title* attribute.
<3> [TODO] shortName
<4> This is the description of your API. It will appear in the OAS file in the *info.description* attribute. Try to keep this description fairly concise, avoid using formatting tags (as the text may appear in many formats: HTML, PDF and OAS rendering). Avoid use of special non-ASCII charcters (such as copyright, trademark symbols) as these can also trip-up later parsing.
<5> This is the identity allocated by the TMForum to this API - typically in the form "TMFxxx" - where "xxx" is a three digit number. It has no direct translation into the OAS file, but will be used by the tooling in generation.
<6> The *hostUrl* translates into the *servers.url* attribute of the OAS file. Note that previous TMF-v4 swagger rules files used a *basePath* attribute which is ignored in OAS file generation.
<7> This is the version of your TMForum API. It follows the SemVer versioning format: <major>.<minor>.<patch>. It appears in the OAS file as attribute: *info.version*.

WARNING: New API development is typically started by copying and pasting an existing, working rules file from another API directory. While this is fine, and encouraged - do take the time to go through the above line-by-line to ensure that you have updated the values to reflect your new API.
Old API values are unlikely to throw tooling errors and will need to be caught by human review. If you take this review time up-front, it will prevent problems permiating the OAS file, User Guide and other published artefacts.

The next section of the rules file describes the resouces of your API and the operations that you are allowing on them.

=== User Guide Deep Dive

* Structure and Template
* Cover Page: Title, Version, Date, Status
* Examples
* Auxillary Diagrams (Lifecycles)

=== Conformance Profile Deep Dive

* Initial Generation
* How to read the file
* How to craft a custom rule

=== Troubleshooting

* Codespace "Express" WebUI
** Stops working
** Generation problems: Looking at the underlying "log.log" file?
** How to run the OAS and user-guide generation without the Express UI?
* Examples are not currently validated against the OAS file

=== Governance Checklists

A table of quick visual tests on the details of the rules file and user guide
As people often start a new rules file with a copy-n-paste from a previous existing file - it is easy for "working errors" to permiate unnoticed.

* API Name: ("Management" convention?)
* API Version: Following SemVer.org
* API Description: Short/Concise: Avoid formatting and non-ASCII characters
* Basepath/Server.URL: Do not use 'basePath' in the rules file - even though it is commonly copy-n-pasted from v4 rules files. It will not reflect in the OAS file.

Schema files

* Use of $ref: /definitions
* Attribute descriptions: Be careful in Common/ to be 'generic'


== Administrative Appendix

This Appendix provides additional background material about the TM Forum
and this document. In general, sections may be included or omitted as
desired, however a Document History must always be included.

=== Document History

==== Version History

This section records the changes between this and the previous document
version as it is edited by the team concerned. Note: this is an
incremental number which does not have to match the release number and
used for change control purposes only.

[options=header]
|===
|Version Number |Date Modified |Modified by | Description of changes

|0.1 |18-Mar-2024 | Stephen Harrop |First layout of the basics

|===

=== Acknowledgments

This document was prepared by the members of the TM Forum API team:

* Stephen Harrop, Vodafone, Editor
* Revathi Sivaji, TM Forum, Contributor
* Heidi Lobecker, TM Forum, Contributor
* Uche Uba, TM Forum, Contributor
